var ScrollContainerType=ScrollContainerType||{};ScrollContainerType.SCROLL="scroll",ScrollContainerType.SLIDER="slider",define("ScrollContainer",["Gesture","messageBus"],function(a,b){var c=function(c,d,e,f,g){function h(){y.interactive=!0,y.mousedown=y.touchstart=j,y.mouseup=y.touchend=k,b.addEventListener("renderer:mouseleave",i)}function i(a){k()}function j(a){b.emit("searchBar:blur"),v=a,T=!0,x=r.update(e),TweenLite.killTweensOf(this),y.dispatchEvent({type:"down"})}function k(){if(T=!1,y.dispatchEvent({type:"up"}),setTimeout(function(){E||b.emit("ScrollContainer:StopMoving")},100),F==ScrollContainerType.SLIDER){var a=v.getLocalPosition(z),c=x.x-a.x,d=c>0?1:-1;u.x>10||Math.abs(c)>w.width*R&&0>d?this._prev(!0):u.x<-10||Math.abs(c)>w.width*R&&d>0?this._next(!0):this._goto(P,Q,!0)}}var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=.4,B=.95,C=.7,D=.25,E=!1,F=c,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=.5,R=1.5,S={},T=!1;PIXI.DisplayObjectContainer.call(this),PIXI.EventTarget.call(this),z=d,o=e,w=f||new PIXI.Rectangle,y=this,l=g,m=e?e.width:0,n=e?e.height:0,G=0,q=new PIXI.Graphics,q.beginFill(16711680,0),q.drawRect(0,0,1,1),q.endFill(),y.addChild(q),F==ScrollContainerType.SLIDER&&(this._slides=function(a){N=a},this._next=function(a){O<N.length-2?O++:O=N.length-1,this._goto(O,Q,a)},this._prev=function(a){O>0?O--:O=0,this._goto(O,Q,a)},this._goto=function(a,b,c){(P!==a||c)&&(p=-N[a].x+(w.width>>1),P=O=a,TweenLite.to(this,b||Q,{x:p,onCompleteParams:[P],onComplete:function(a){t&&t(a)}}),s&&s(P))},this._viewPort=function(a){w=a,this._goto(P,.25,!0)}),this._viewRect=function(a){q.scale.x=m=a.width,q.scale.y=n=a.height,F==ScrollContainerType.SLIDER&&this._goto(P,.25,!0)},this._update=function(a){return p=r.update(a),L+=(p.y-this._lastMouseDownPoint.y)*A,M+=(p.x-this._lastMouseDownPoint.x)*A,this._lastMouseDownPoint=p,L*=C,M*=C,F===ScrollContainerType.SLIDER&&(u=MathUtils.getMovement(S,v.getLocalPosition(z))),p},this._back=function(){H=this.position.y,I=this.position.x,J=0,K=0,o&&(H>G||n<=w.height?J=-H*D:H+n<w.height&&(J=(w.height-n-H)*D),I>G||m<=w.width?K=-I*D:I+m<w.width&&(K=(w.width-m-I)*D)),Math.abs(L)<=.2&&(L=0),Math.abs(M)<=.2&&(M=0),L*=B,M*=B,"y"!=l&&(this.position.y+=Math.round(L+J)),"x"!=l&&(this.position.x+=Math.round(M+K)),0===Math.abs(M)&&0===Math.abs(L)||E!==!1||(b.emit("ScrollContainer:StartMoving"),E=!0),Math.abs(M)<=0&&Math.abs(L)<=0&&E===!0&&(b.emit("ScrollContainer:StopMoving"),E=!1)},this._onChange=function(a){s=a},this._onAfterChange=function(a){t=a},this.isDown=function(){return T},this.type=function(){return F},this._currentID=function(){return P},this._transitionTime=function(a){Q=a},this._touchable=function(a){y.interactive=a,r.drag(z,this)},this._margeToSlide=function(a){R=a},this.progress=function(){var a=-(this.position.y/(n-w.height));a=0>=a?0:a>=1?1:a,this.progressCallBack&&this.progressCallBack(a)},r=new a(l),r.drag(z,this),this.position.x=0,this.position.y=0,h()};return c.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),c.prototype.onChange=function(a){this._onChange(a)},c.prototype.onAfterChange=function(a){this._onAfterChange(a)},c.prototype.next=function(){this._next()},c.prototype.prev=function(){this._prev()},c.prototype.goTo=function(a){this._goto(a)},c.prototype.setSlides=function(a){this._slides(a)},c.prototype.viewRect=function(a){this._viewRect(a)},c.prototype.viewPort=function(a){this._viewPort(a)},c.prototype.setTransitionTime=function(a){this._transitionTime(a)},c.prototype.touchable=function(a){this._touchable(a)},c.prototype.setMargeToSlide=function(a){this._margeToSlide(a)},c.prototype.upDate=function(a){return this._update(a)},c.prototype.back=function(){this._back()},c.prototype.scroll=function(a){this.isDown()?this.upDate(a):this.type()==ScrollContainerType.SCROLL&&this.back(),this.progressCallBack&&(_oldY!==this.position.y&&this.progress(),_oldY=this.position.y)},c.prototype.progress=function(){this.progress()},c.prototype.onProgress=function(a){this.progressCallBack=a},c.prototype.dispose=function(){this._dispose()},c}),define("autocomplete",["components/services"],function(a){var b=new a,c=function(a){var c=this;this.el=a,this.$el=$(this.el),this.$el.typeahead({minLength:3,items:5,highlighter:function(a){var b="";return b+="<span class='typeahead-item'>",b+="<span class='typeahead-picture'>",b+="<img src='"+a.face.picture+"' alt='' />",b+="</span>",b+="<span class='typeahead-label-wrapper'>",b+="<span class='typeahead-label'>"+a.toString(),b+="</span>",b+="<br />",b+="<span class='typeahead-number'>Face number : "+a.face.number+"</span>",b+="</span>",b+="</span>"},afterSelect:function(){c.$el.closest("form").submit()},source:function(a,c){return console.log("autocomplete","source",arguments),b.searchFaces(a,function(a,b){var d=[];return _.each(a,function(a){var b=new String(a.accountname);b.face=a,d.push(b)}),c(d)})}})};return c}),define("btnSocial",function(){var a=function(a,b,c,d,e,f){PIXI.DisplayObjectContainer.call(this);var g,h;this.isHide=!1,f=f||60,g=new PIXI.Graphics,g.beginFill(16711680,0),g.drawRect(0,0,d||30,e||30),g.endFill(),g.interactive=!0,g.buttonMode=!0,g.tap=g.click=c,h=new PIXI.Text(a,{font:f+"px fontello",fill:b||"#FFFFFF"}),h.x=g.width/2-h.width/2,h.y=g.height/2-h.width/2,h.pivot.x=h.pivot.y=-h.width/2,h.scale.x=h.scale.y=.5,this._btn=g,this._text=h,this.addChild(g),this.addChild(h)};return a.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),a.constructor=a.prototype.constructor,a.prototype.enable=function(a,b){var a,b;a=a||.25,b=b||0,this._btn.interactive=this._btn.buttonMode=!0,TweenLite.to(this,a,{alpha:1,delay:b})},a.prototype.hideElement=function(){this.visible=!1,this.isHide=!0},a.prototype.showElement=function(){this.visible=!0,this.isHide=!1},a.prototype.disable=function(a,b){var a,b;a=a||.25,b=b||0,this._btn.interactive=this._btn.buttonMode=!1,TweenLite.to(this,a,{alpha:.1,delay:b})},a}),define("cacheControl",function(){_cached={};var a=function(){};return a.prototype.checkFromCache=function(a){return a in _cached},a.prototype.getFromCache=function(a){return _cached[a]},a.prototype.cache=function(a,b){_cached[a]=b},a}),define("colorMapping",function(){function a(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function b(b,c,d){return"#"+a(b)+a(c)+a(d)}_mapping={0:16711680,200:65280,400:255,600:16711935,800:65535,999:16776960,1000:16711680,1200:65280,1400:255,1600:16711935,1800:65535,1999:16776960,2000:16711680,2200:65280,2400:255,2600:16711935,2800:65535,2999:16776960,3000:10066329,3200:10066329,3400:10066329,3600:10066329,3800:10066329,3999:10066329};var c=function(){};return c.prototype.getColorByBoxNumber=function(a){var b=5592405;for(var c in _mapping)a>1*c&&(b=_mapping[c]);return b},c.prototype.getRgbByPosition=function(a,b,c,d){var e,f,g;return e=f=g=0,this.rgbToHex(e,f,g)},c.prototype.rgbToHex=function(a,c,d){return b(a,c,d)},new c}),define("Gesture",[],function(){function a(a,b){return{x:b.x-a.x>=0?b.x-a.x:b.x-a.x,y:b.y-a.y>=0?b.y-a.y:b.y-a.y}}var b=function(a){var b=this;b._constraintAxe=a,b._isDown=!1,b._target=null,b._domElement=null,b._inc={x:0,y:0},b._pos={x:0,y:0},_move={x:0,y:0},_mouse={x:0,y:0},b.onMove=function(a){_mouse=a.getLocalPosition(this),b._pos=_mouse},b.onDown=function(a){_mouse=a.getLocalPosition(this),b.initPosItem(),b._isDown=!0},b.onUp=function(a){_mouse=a.getLocalPosition(this),b._isDown=!1,this._target&&(b._target.oldx=b._target.position.x,b._target.oldy=b._target.position.y)},b.initPosItem=function(){this._target&&(b._pos=_mouse,b._target.oldPos.x=b._target.position.x,b._target.oldPos.y=b._target.position.y,b._target.startPoint.x=b._pos.x,b._target.startPoint.y=b._pos.y,b._target._lastMouseDownPoint=b._pos)}};return b.prototype.drag=function(a,b,c){a.mousedown=a.touchstart=this.onDown,a.mouseup=a.touchend=this.onUp,a.mousemove=a.touchmove=this.onMove,this._target=b,this._moveCallBack=c,this._target&&(this._target.oldPos={x:this._target.position.x,y:this._target.position.y},this._target.startPoint={x:0,y:0},this.initPosItem(),this._isDown=!0)},b.prototype.update=function(b){if(this._target){if(this._isDown){this._inc.x=this._pos.x,this._inc.y=this._pos.y,_move=a(this._target.startPoint,this._inc);var c=Math.round(_move.x+this._target.oldPos.x);"x"!=this._constraintAxe&&(b?0>=c?this._target.position.y=0:c>=b.width-this._target.width?this._target.position.x=b.width-this._target.width:this._target.position.x=c:this._target.position.x=c,this._moveCallBack&&this._moveCallBack(),this._oldx=this._target.position.x);var d=Math.round(_move.y+this._target.oldPos.y);"y"!=this._constraintAxe&&(b?0>=d?this._target.position.y=0:d>=b.height-this._target.height?this._target.position.y=b.height-this._target.height:this._target.position.y=d:this._target.position.y=d,this._moveCallBack&&this._moveCallBack(),this._oldy=this._target.position.y)}return this._pos}},b}),define("mapBlur",["messageBus"],function(a){var b=function(b,c,d){PIXI.DisplayObjectContainer.call(this),this.toBlur=new PIXI.DisplayObjectContainer,this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight,this.itemWidth=c,this.itemHeight=d,this.visible=!1,this.objectToBlur=b,this.renderTexture=new PIXI.RenderTexture(this.innerWidth,this.innerHeight),this.sprite=new PIXI.Sprite(this.renderTexture),this.tint=new PIXI.Graphics,this.tintBlack=new PIXI.Graphics,this.tint.blendMode=PIXI.blendModes.MULTIPLY,this.blurMask=new PIXI.Graphics,this.resize(),this.position.x=0,this.position.y=0,this.toBlur.mask=this.blurMask,a.on("map:blur",_.bind(this.blurMap,this)),a.on("map:unblur",_.bind(this.unBlurMap,this)),a.on("all:colorChange",_.bind(this.updateBlurColor,this)),this.addChild(this.toBlur),this.toBlur.addChild(this.sprite),this.toBlur.addChild(this.tint),this.toBlur.addChild(this.tintBlack)};return b.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),b.prototype.constructor=b.constructor,b.prototype.updateBlurColor=function(a){var b=a&&a.data?a.data.color:16711680;this.tint.clear(),this.tint.beginFill(b,1),this.tint.drawRect(0,0,this.innerWidth,this.innerHeight),this.tint.endFill()},b.prototype.blurMap=function(){this.visible=!0,TweenLite.fromTo(this,.5,{alpha:0},{alpha:1})},b.prototype.unBlurMap=function(){TweenLite.fromTo(this,.5,{alpha:1},{alpha:0,onComplete:function(){this.visible=!1}})},b.prototype.process=function(){this.visible&&this.renderTexture.render(this.objectToBlur)},b.prototype.resize=function(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight,this.renderTexture.resize(this.innerWidth,this.innerHeight),this.sprite.width=this.innerWidth,this.sprite.height=this.innerHeight,this.tint.clear(),this.tint.beginFill(16711680,1),this.tint.drawRect(0,0,this.innerWidth,this.innerHeight),this.tint.endFill(),this.tintBlack.clear(),this.tintBlack.beginFill(0,1),this.tintBlack.drawRect(0,0,this.itemWidth,this.itemHeight),this.tintBlack.endFill(),this.tintBlack.position.x=this.innerWidth/2-this.itemWidth/2,this.tintBlack.position.y=this.innerHeight/2-this.itemHeight/2,this.blurMask.clear(),this.blurMask.beginFill(0,1),this.blurMask.moveTo(0,0),this.blurMask.lineTo(this.tintBlack.position.x,0),this.blurMask.lineTo(this.tintBlack.position.x,this.tintBlack.position.y+this.tintBlack.height),this.blurMask.lineTo(this.tintBlack.position.x+this.tintBlack.width,this.tintBlack.position.y+this.tintBlack.height),this.blurMask.lineTo(this.tintBlack.position.x+this.tintBlack.width,this.tintBlack.position.y),this.blurMask.lineTo(this.tintBlack.position.x,this.tintBlack.position.y),this.blurMask.lineTo(this.tintBlack.position.x,0),this.blurMask.lineTo(this.innerWidth,0),this.blurMask.lineTo(this.innerWidth,this.innerHeight),this.blurMask.lineTo(0,this.innerHeight),this.blurMask.lineTo(0,0),this.blurMask.endFill(),this.process()},b}),define("mapCursor",["btnSocial","constantes","messageBus"],function(a,b,c){var d=function(){PIXI.DisplayObjectContainer.call(this),this.number=new PIXI.DisplayObjectContainer,this.cursor=new PIXI.DisplayObjectContainer,this.numberText=new PIXI.Text("1",{font:"22px montserrat-light",fill:"#FFFFFF"}),this.numberText.scale.x=this.numberText.scale.y=.5,this.cursorIcon=new a(b.icons.COORDINATES,"#FFFFFF"),this.cursorIcon.interactive=this.cursorIcon.buttonMode=!0,this.pivot.y=65,this.cursor.pivot.x=15,this.number.position.y=-15,this.unDragging(),this.addChild(this.number),this.addChild(this.cursor),this.cursor.addChild(this.cursorIcon),c.on("all:colorChange",_.bind(this.updateCursorColor,this)),c.on("all:colorChange",_.bind(this.updateNumberColor,this)),this.number.addChild(this.numberText)};return d.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),d.constructor=d.prototype.constructor,d.prototype.updateNumberColor=function(a){var b=a&&a.data?a.data.color:16777215;this.numberText.tint=b},d.prototype.updateCursorColor=function(a){var b=a&&a.data?a.data.color:16777215;this.cursorIcon._text.tint=b},d.prototype.dragging=function(){},d.prototype.unDragging=function(){},d.prototype.setNumber=function(a){this.numberFace=a,this.numberText.setText(this.numberFace),this.numberText.pivot.x=this.numberText.width/2},d}),define("messageBus",function(){var a={};return PIXI.EventTarget.call(a),a}),define("pagination",["messageBus"],function(a){var b=function(a){var b=this;this.$el=$(a),this.$label=this.$el.find(".search-pagination-label"),this.$buttonPrev=this.$el.find(".search-pagination-button-prev"),this.$buttonNext=this.$el.find(".search-pagination-button-next"),this.data=[],this.current=0,this.length=0,this.setData(),this.$buttonPrev.on("mousedown",function(a){a.preventDefault(),b.previous()}),this.$buttonNext.on("mousedown",function(a){a.preventDefault(),b.next()})};return b.prototype.reset=function(){this.setData([])},b.prototype.setData=function(a){return this.data=a||[],this.length=this.data.length,this.current=0,this.el={},this.update()},b.prototype.next=function(){return this.setNextIndex(),this.update()},b.prototype.previous=function(){return this.setPrevIndex(),this.update()},b.prototype.getCurrent=function(){return this.el},b.prototype.update=function(){return this.el=this.data[this.current],this.el&&(Backbone.history.navigate("number/"+this.el.number,{trigger:!1}),a.emit("map:gotoFaceNumber",{number:this.el.number,directly:!1})),this.updatePaginationButtons(),this.el},b.prototype.setPrevIndex=function(){return this.current--,this.current<0&&(this.current=this.length-1),this.current},b.prototype.setNextIndex=function(){return this.current++,this.current>=this.length&&(this.current=0),this.current},b.prototype.updatePaginationButtons=function(){this.setPaginationLabel(this.current),this.length>1?this.showPaginationButtons():this.hidePaginationButtons()},b.prototype.setPaginationLabel=function(){this.length>0?this.$label.text(this.current+1+"/"+this.length):this.$label.text("")},b.prototype.showPaginationButtons=function(){this.$buttonPrev.addClass("is-active"),this.$buttonNext.addClass("is-active")},b.prototype.hidePaginationButtons=function(){this.$buttonPrev.removeClass("is-active"),this.$buttonNext.removeClass("is-active")},b}),define("searchBar",["messageBus","components/services","pagination","autocomplete"],function(a,b,c,d){var e=new b,f="",g=function(b){var e=this;this.pagination=new c("#search-field-pagination"),this.autocomplete=new d("#search-field"),this.$field=$("#search-field"),this.$form=$("#form-search"),this.$reset=this.$form.find(".search-reset"),this.$buttonSubmit=this.$form.find(".search-submit"),this.$field.on("keyup change blur focus",function(a){var b=e.$field.val();""!==b?e.enableReset():e.disableReset()}),this.$buttonSubmit.on("click",function(){e.$form.submit()}),a.on("searchBar:blur",function(){e.$field.blur()}),this.$form.on("submit",function(a){a.preventDefault();var c=e.$field.val();return f!==c||1*c>=0?(b.blurAfterSubmit===!0&&e.$field.blur(),e.submit(a,c),e._submitCallback&&e._submitCallback(a,c),void(f=c)):void e.pagination.next()}),this.$reset.on("mousedown",function(){e.reset()})};return g.prototype.enableReset=function(){this.$reset.addClass("is-active"),this.$form.addClass("extended")},g.prototype.disableReset=function(){this.$reset.removeClass("is-active"),this.$form.removeClass("extended")},g.prototype.reset=function(a){this.$field.val(""),this.disableReset(),this.pagination.reset(),f=""},g.prototype.submit=function(b,c){var d=this;1*c>=0?(Backbone.history.navigate("number/"+1*c,{trigger:!1}),a.emit("map:gotoFaceNumber",{number:1*c,directly:!1}),d.pagination.reset()):c.length>2&&e.searchFaces(c,function(a,b){d.pagination.setData(a),console.log("SEARCH RESULTS",a)})},g.prototype.onSubmit=function(a){this._submitCallback=a},g}),define("components/services",["cacheControl","messageBus"],function(a,b){var c=new a,d=function(){this.getFacesByRange=function(a,d){var e,f="/api/faces_by_range/"+a.toString();c.checkFromCache(f)?d(c.getFromCache(f)):e=$.getJSON(f).done(function(a){d(a),c.cache(f,a),b.emit("main:hideLoader")}).fail(function(a,c,d){var e=c+", "+d;console.log("Request Failed: "+e),b.emit("main:hideLoader")})},this.getFaces=function(a,b,d){var e="/api/faces_by_number/"+a;c.checkFromCache(e)?b(c.getFromCache(e),d,a):$.getJSON(e,{id:d}).done(function(f){b(f,d,a),c.cache(e,f)}).fail(function(a,b,c){var d=b+", "+c;console.log("Request Failed: "+d)})},this.searchFaces=function(a,b){var d="/api/faces/search/"+a;c.checkFromCache(d)?(console.log("from cache",c.getFromCache(d)),b(c.getFromCache(d),a)):$.getJSON(d).done(function(e){b(e,a),c.cache(d,e)}).fail(function(a,b,c){var d=b+", "+c;console.log("Request Failed: "+d)})}};return d}),define("bloc",["blocIthem"],function(a){var b=function(b,c,d,e){function f(){for(var d=0,e=0,f=0;j>f;f++){for(var k=0;i>k;k++)h=new a(b,c),h.x=d,h.y=e,g.addChild(h),n[m]=h,m++,d+=b;d=0,e+=c}}PIXI.DisplayObjectContainer.call(this),PIXI.EventTarget.call(this);var g,h,i=d,j=e,k=i*b,l=j*c,m=0,n=[];g=this,g._width=k,g._height=l,f(),this.setValue=function(a){for(var b=0;b<a.length;b++)if(a[b].number>=0&&n[b]){var c=a[b].number,d=main.martixRange[c];n[b].update(d),n[b].updateImage(d.picture)}},this.process=function(){},this.resize=function(a,b){}};return b.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),b.prototype.process=function(){this.process()},b.prototype.resize=function(a,b){this.resize(a,b)},b}),define("blocIthem",["constantes","btnSocial","messageBus","colorMapping"],function(a,b,c,d){var e=function(e,f){function g(){u=new PIXI.DisplayObjectContainer,R=new PIXI.DisplayObjectContainer,G=new PIXI.Graphics,y=new PIXI.Graphics,v=new PIXI.Sprite(new PIXI.Texture(new PIXI.BaseTexture)),v.x=Math.round((e-U)/2),v.y=Math.round((f-V)/2),w=new PIXI.Text("#",{font:"11px montserrat-light",fill:"#aaaaaa"}),w.rotation=90*Math.PI/180,w.x=e-8,w.y=T/2,x=new PIXI.Text("Julien",{font:"11px montserrat-light",fill:"#aaaaaa"}),x.position.x=Math.round(T/2),x.position.y=Math.round(T-32),A=new b(a.icons.FACEBOOK,"#3a5795",j,null,null,60),A.x=20,A.y=f-20-A.height,B=new b(a.icons.TWITTER,"#55acee",i,null,null,60),B.x=e-20-B.width,B.y=f-20-B.height,C=new b(a.icons.SHARE,"#00FFFF",h),C.x=e/2-15,C.y=(f+30)/2-15,D=new b(a.icons.CIRCLE_ARROW_DOWN,"#00EE00",r),D.x=e/2-35,D.y=(f+30)/2-15,E=new b(a.icons.CIRCLE_CLOSE,"#EE0000",s),E.x=e/2+5,E.y=(f+30)/2-15,O=new PIXI.Sprite(new PIXI.Texture(new PIXI.BaseTexture)),P=new PIXI.Sprite(new PIXI.Texture(new PIXI.BaseTexture)),Q=new PIXI.Sprite(new PIXI.Texture(new PIXI.BaseTexture)),L=new PIXI.Text("#",{font:"32px fontello",fill:"#aaaaaa"}),M=new PIXI.Text("#",{font:"32px fontello",fill:"#aaaaaa"}),N=new PIXI.Text("#",{font:"32px fontello",fill:"#aaaaaa"}),L.scale.x=L.scale.y=.5,M.scale.x=M.scale.y=.5,N.scale.x=N.scale.y=.5,L.position.x=T/2,L.position.y=V+T/2+2,M.position.x=T/2+22,M.position.y=V+T/2+2,N.position.x=T/2+44,N.position.y=V+T/2+2,O.position.x=U,O.position.y=V+T/2+4,P.position.x=U-25,P.position.y=V+T/2+4,Q.position.x=U-50,Q.position.y=V+T/2+4,O.visible=P.visible=Q.visible=!1,O.scale=P.scale=Q.scale={x:.25,y:.25},L.visible=M.visible=N.visible=!1,R.alpha=0,c.addEventListener("ScrollContainer:StartMoving",function(){B.disable(.25,0),A.disable(.25,0),D.disable(.25,0),E.disable(.25,0)}),c.addEventListener("ScrollContainer:StopMoving",function(){var a=Math.random()/3;B.enable(.25,a),A.enable(.25,a),D.enable(.25,a),E.enable(.25,a)}),c.on("blocItem:setUnselected",_.bind(n,S)),c.on("blocItem:setSelected",_.bind(o,S)),c.on("ScrollContainer:StartMoving",m),J=l(),t.mousedown=t.touchstart=k,q(0),t.addChild(G),t.addChild(u),t.addChild(w),u.addChild(y),u.addChild(v),u.addChild(A),u.addChild(B),u.addChild(C),u.addChild(D),u.addChild(E),u.addChild(R),R.addChild(x),R.addChild(O),R.addChild(P),R.addChild(Q),R.addChild(L),R.addChild(M),R.addChild(N)}function h(a){Backbone.history.navigate("/share/"+F,{trigger:!0})}function i(a){parent.location="/auth/twitter/register/"+F}function j(a){parent.location="/auth/facebook/register/"+F}function k(){console.log("onFaceClick"),console.log(H),m(),K=setTimeout(function(){I&&(X?(Backbone.history.navigate("/",{trigger:!0}),setUnSelected()):(Backbone.history.navigate("profile/"+H.accountname,{trigger:!0}),_.bind(o,S)(H.number),c.emit("map:gotoFaceNumber",{number:H.number,directly:!1})))},W)}function l(){var a=new TimelineLite;return a.to(R,.5,{alpha:1,onReverseComplete:function(){S.updateColors({data:{color:16777215}})}}),a.pause(),a}function m(){clearTimeout(K),c.emit("blocItem:setUnselected")}function n(){X=!1,1===R.alpha&&(c.emit("map:unblur"),J.reverse())}function o(a){if(!X){var b=a;"object"==typeof a&&(b=a.data.number),b===H.number&&(X=!0,this.setLangs(H.lang?[H.lang]:[]),this.setOccupations(H.occupations?$.parseJSON(H.occupations):[]),this.updateColors({data:{color:d.getColorByBoxNumber(H.number)}}),x.setText(H.accountname||""),J.play(),c.emit("all:colorChange",{color:d.getColorByBoxNumber(H.number)}),c.emit("map:blur"))}}function p(a){a=""+a;var b="000000";return b.substring(0,b.length-a.length)+a}function q(a){var b=5592405,c=d.getColorByBoxNumber(a);y.visible=!(H&&H.accountname),y.clear(),y.beginFill(c,1),y.drawRect(0,0,v.width-6,v.height-6),y.endFill(),y.position.x=v.position.x+3,y.position.y=v.position.y+3,G.clear(),G.beginFill(b,1),G.drawRect(0,0,e,f),G.endFill()}function r(a){parent.location="/auth/twitter/claim/"+H.accountname}function s(a){parent.location="/auth/twitter/decline/"+H.accountname}var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S=this,T=40,U=e-T,V=f-T,W=500,X=!1;PIXI.DisplayObjectContainer.call(this),t=this,this.process=function(){},this.resize=function(a,b){},this.updateColors=function(a){console.log("updateColors");var b=a&&a.data?a.data.color:16777215;w.tint=b,x.tint=b,L.tint=b,M.tint=b,N.tint=b},this.hideSocials=function(){A.hideElement(),B.hideElement()},this.showSocials=function(){A.showElement(),B.showElement()},this.hideShare=function(){C.hideElement()},this.showShare=function(){C.showElement()},this.hideClaims=function(){D.hideElement(),E.hideElement()},this.showClaims=function(){D.showElement(),E.showElement()},this.setInteractive=function(a){I=a,t.interactive=a,t.buttonMode=a},this.setShare=function(a){this[a?"showShare":"hideShare"]()},this.setSocials=function(a){this[a?"showSocials":"hideSocials"]()},this.setClaim=function(a){this[a?"showClaims":"hideClaims"]()},this.setLangs=function(a){var b=1;O.visible=!1,P.visible=!1,Q.visible=!1,_.each(a,function(a){var c,d;switch(a=a.substr(0,2).toUpperCase(),b){case 1:c=O;break;case 2:c=P;break;case 3:c=Q;break;default:return}if(c){if(d="/img/lang/"+a+".png","undefined"==typeof d)return void console.log("Unknown flag in constante langs : "+d+" - "+a.toUpperCase());console.log("flags",d),c.setTexture(new PIXI.Texture(PIXI.Texture.fromImage(d))),c.visible=!0}b++})},this.setOccupations=function(b){var c=1;L.visible=!1,M.visible=!1,N.visible=!1,_.each(b,function(b){var d,e;switch(c){case 1:d=L;break;case 2:d=M;break;case 3:d=N;break;default:return}if(d){if(e=a.occupations[b.toUpperCase()],"undefined"==typeof e)return void console.log("Unknown icon in constante occupations : "+e+" - "+b);d.setText(e),d.visible=!0}c++})},this.update=function(a){H=a,F=z=H.number,this.setInteractive(H.accountname&&!(H.claim===!1&&!main.currentUser)),this.setSocials("undefined"==typeof H.claim&&!main.currentUser),this.setClaim(H.claim===!1&&!main.currentUser),this.setShare(main.currentUser&&!H.accountname),q(F),w.setText(p(1*z)),v.texture.destroy(),v.texture=new PIXI.Texture(new PIXI.BaseTexture)},this.updateImage=function(a){var b=new PIXI.ImageLoader(a);b.onLoaded=function(){var b=new PIXI.Texture(PIXI.Texture.fromImage(a));v.texture.destroy(),v.setTexture(b),v.width=U,v.height=V},b.load()},g()};return e.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),e.prototype.process=function(){this.process()},e.prototype.resize=function(a,b){this.resize(a,b)},e}),define("constantes",function(){var a={};a.icons={},a.icons.FONT_NAME="fontello",a.icons.FACEBOOK="N",a.icons.TWITTER="B",a.icons.GEEK_MOUSE="A",a.icons.ATHLETE_BASKETBALL="Z",a.icons.HYPE_TIE="R",a.icons.WORKER_BRIEFCASE="E",a.icons.EXPLORER_ROCKET="T",a.icons.PARENT="Y",a.icons.SCIENTISTS="U",a.icons.STUDENT="I",a.icons.UNDISCLOSED="O",a.icons.CIRCLE_ARROW_DOWN="Q",a.icons.NOUN_ARTIST="P",a.icons.CIRCLE_CLOSE="S",a.icons.CLOSE="?",a.icons.LOGIN="C",a.icons.LOGOUT="V",a.icons.HELP="M",a.icons.SETTING_EDIT="G",a.icons.CAUTION="D",a.icons.COORDINATES="F",a.icons.USER="K",a.icons.HOME="J",a.icons.SEARCH="H",a.icons.SHARE="L",a.icons.ARROW_RIGHT="X",a.icons.ARROW_LEFT="W",a.occupations={},a.occupations.GEEK=a.icons.GEEK_MOUSE,a.occupations.ATHLETE=a.icons.ATHLETE_BASKETBALL,a.occupations.HYPE=a.icons.HYPE_TIE,a.occupations.WORKER=a.icons.WORKER_BRIEFCASE,a.occupations.EXPLORER=a.icons.EXPLORER_ROCKET,a.occupations.PARENT=a.icons.PARENT,a.occupations.SCIENTIST=a.icons.SCIENTISTS,a.occupations.STUDENT=a.icons.STUDENT,a.occupations.UNDISCLOSED=a.icons.UNDISCLOSED,a.occupations.ARTIST=a.icons.NOUN_ARTIST;var b=function(a,b){var c=document.createElement("div");c.style.fontFamily=a,c.innerHTML=b,document.body.appendChild(c),setTimeout(function(){document.body.removeChild(c)},100)};return b(a.icons.FONT_NAME,a.icons.FACEBOOK),a});var main=main||{};define("main",["map","messageBus","searchBar"],function(a,b,c){var d=function(d){function e(){w=new PIXI.Stage(0),x={view:M,transparent:!1,resolution:window.devicePixelRatio||1},y=PIXI.autoDetectRecommendedRenderer(0,0,x),M||document.body.appendChild(y.view),h(),b.on("main:hideLoader",f),b.on("main:showLoader",g),y.view.addEventListener("mouseleave",function(a){b.emit("renderer:mouseleave")})}function f(){O||TweenLite.to(P,.25,{opacity:0,delay:1,onComplete:function(){TweenLite.set(P,{display:"none"}),O=!0}})}function g(){O&&TweenLite.fromTo(P,.25,{display:"block",opacity:0},{opacity:1,onComplete:function(){O=!1}})}function h(){i(),Tools.loadFont(["Proxima"],l)}function i(){u=new PIXI.DisplayObjectContainer,w.addChild(u)}function j(){console.log("INIT PAGES"),main.stage=w,main.view=y.view,main.resolution=window.devicePixelRatio||1,main.textResolution=2,main.fonts={Proxima:"Proxima"},main.martixRange=[],z=new a,u.addChild(z)}function k(){console.log("INIT EVENTS"),window.addEventListener("resize",main.onResize),main.onResize(null)}function l(){new c({blurAfterSubmit:!1}),console.log("<< start >>"),console.log("DATA:",N),j(),k(),requestAnimFrame(o),N.editedFace&&editFace(),m(),n(),G&&p()}function m(){}function n(){var a=Backbone.Router.extend({routes:{"edit/":"edit","success/":"success","share/:number":"share","number/:number":"number","login/":"login"},edit:function(a){console.log("BACKBONE EDIT",a),s()},success:function(a){console.log("BACKBONE EDIT",a),t()},login:function(a){console.log("BACKBONE LOGIN",a),q()},share:function(a){console.log("BACKBONE SHARE",a),r(a)},logout:function(a){console.log("BACKBONE EDIT",a)},number:function(a){console.log("BACKBONE NUMBER",a),b.emit("map:gotoFaceNumber",{number:a,directly:!1})}}),c=new a;$(".modal").on("hide.bs.modal",function(a){c.navigate("",{trigger:!1,replace:!0})}),console.log("ROUTER START",Backbone.history.start),Backbone.history.start({pushState:!1})}function o(){requestAnimFrame(o),y.render(w),z&&z.process&&z.process(),G&&v.update()}function p(){v=new Stats,v.domElement.style.position="absolute",v.domElement.style.top="0px",v.domElement.style.left="0px",v.domElement.style.opacity="0.5",document.body.appendChild(v.domElement)}function q(){$(".modal-login").modal("show")}function r(a){$(".js-share-url").val(N.config.root_url+"/number/"+a),$(".js-share-iframe").attr("src","/share/"+a),$(".modal-share").modal("show")}function s(){$(".modal-edit").modal("show")}function t(){$("#edit-user").data("register","true"),$(".modal-edit").modal("show")}console.log("<< Kamal::main >>");var u,v,w,x,y,z,A,B,C,D,E,F,G=!0,H=!1,I=1280,J=800,K=2048,L=1536,M=d[0],N=d[1],O=!1,P=$(".loading-container").get(0);this.currentUser=N.currentUser,main.onResize=function(){C=window.innerHeight,D=window.innerWidth,H&&"desktop"==Tools.getDevice()&&(D>=I&&(D=I),C>=J&&(C=J),E=window.innerWidth-D>>1,F=window.innerHeight-C>>1),A=D/K,B=C/L,z&&z.resize&&z.resize(D,C,A,B,E,F),y.resize(D,C),y.view.style.width=D+"px",y.view.style.height=C+"px",window.scrollTo(0,0)},e()};return d}),define("map",["ScrollContainer","bloc","components/services","messageBus","minimap","mapBlur"],function(a,b,c,d,e,f){var g=function(){function g(){var c,g;for(c=0;T>c;c++)for(g=0;U>g;g++){for(var k=[],m=0;V>m;m++)k.push({number:ca,picture:"img/FREESTATE0"+parseInt(MathUtils.randomMinMax(1,4))+".png"}),main.martixRange[ca]={number:ca,picture:"/img/FREESTATE0"+parseInt(MathUtils.randomMinMax(1,4))+".png"},ca++;ba[g+","+c]=k}y=new a(ScrollContainerType.SCROLL,main.stage),C=new f(E,G,H),z=new e($,aa,G,H,Y,Z),y.addEventListener("down",h),y.addEventListener("up",j),w.addChild(E),w.addChild(C),w.addChild(z),E.addChild(y),i();var n=0,p=0,s=[];for(c=0;N>c;c++){for(g=0;M>g;g++)x=new b(G,H,X,W),D[O]=x,x.idX=x.initidX=g,x.idY=x.initidY=c,x.lock0=x.lock1=!0,s.push({blocId:O,range:q(g,c)}),x.x=n,x.y=p,y.addChild(x),n+=x._width,n>=P&&(P=n),O++;n=0,p+=D[O-1]._height,p>Q&&(Q=p)}R=x._width,S=x._height,l(),r(s),ga(),d.on("map:gotoFaceNumber",o)}function h(a){l(),clearTimeout(da),da=setTimeout(function(){d.emit("ScrollContainer:StartMoving")},250)}function i(){var a,b;a=20,b=window.innerHeight-aa-20,z.position.x=a,z.position.y=b}function j(){clearTimeout(da)}function k(){for(var a,b,c=!1,d=[],e=0;e<D.length;e++)a=y.y+D[e].y,a>B?(D[e].y-=Q,D[e].idY>=N?D[e].idY-=N:D[e].idY=T+D[e].initidY-N,d.push({blocId:e,range:q(D[e].idX,D[e].idY)}),c=!0):-S>a&&y.y+(D[e].y+Q)<=B&&(D[e].y+=Q,D[e].idY<=T-1-N?D[e].idY+=N:D[e].idY=D[e].initidY,d.push({blocId:e,range:q(D[e].idX,D[e].idY)}),c=!0),b=y.x+D[e].x,b>A?(D[e].x-=P,D[e].idX>=M?D[e].idX-=M:D[e].idX=U+D[e].initidX-M,d.push({blocId:e,range:q(D[e].idX,D[e].idY)}),c=!0):-R>b&&y.x+(D[e].x+P)<=A&&(D[e].x+=P,D[e].idX<=U-1-M?D[e].idX+=M:D[e].idX=D[e].initidX,d.push({blocId:e,range:q(D[e].idX,D[e].idY)}),c=!0);c&&r(d),fa&&ga()}function l(){for(var a=0;a<D.length;a++)D[a].oldPos={x:D[a].position.x,y:D[a].position.y}}function m(a,b,c){var d,e,f,g,h,i={x:0,y:0},j=Math.round(-window.innerWidth/2)+Math.round(G/2),k=Math.round(-window.innerHeight/2)+Math.round(H/2);a=a*-G-j,b=b*-H-k,c===!0?e=0:(f=n(a,b),d=MathUtils.distance(y,f),e=Math.max(I,Math.min(J,d/1e3))),g=e===J,g?(i.x=.05*(f.x-y.position.x),i.y=.05*(f.y-y.position.y),h=new TimelineLite,h.to(y,.5,{alpha:0},0).to(y.position,1,{x:"+="+i.x,y:"+="+i.y,ease:Cubic.easeOut},0).to(y,0,{x:f.x-i.x,y:f.y-i.y,ease:Cubic.easeOut}).to(y,2,{x:f.x,y:f.y,delay:1,ease:Cubic.easeOut}).to(y,.5,{alpha:1},"-=1")):TweenLite.to(y,e,{x:f.x,y:f.y,ease:Cubic.easeOut})}function n(a,b){var c={x:{n:0},y:{n:0}};c.x.n=Math[a>=0?"floor":"ceil"](a/Y),c.y.n=Math[b>=0?"floor":"ceil"](a/Y);var d=Math.min(a+c.x.n*Y-Y,a+c.x.n*Y,a+(c.x.n+1)*Y),e=Math.min(b+c.y.n*Z-Z,b+c.y.n*Z,b+(c.y.n+1)*Z);return d=Math.abs(a+(c.x.n-1)*Y)<Math.abs(a+c.x.n*Y)?a+(c.x.n-1)*Y:Math.abs(a+c.x.n*Y)<Math.abs(a+(c.x.n+1)*Y)?a+c.x.n*Y:a+(c.x.n+1)*Y,e=Math.abs(b+(c.y.n-1)*Z)<Math.abs(b+c.y.n*Z)?b+(c.y.n-1)*Z:Math.abs(b+c.y.n*Z)<Math.abs(b+(c.y.n+1)*Z)?b+c.y.n*Z:b+(c.y.n+1)*Z,
{x:d,y:e}}function o(a){var b=!1,c=a;"object"==typeof a&&(c=a.data.number,b=a.data.directly);var d,e;c=Math.max(K,Math.min(L,c)),d=Math.round(c%1e3),e=Math.floor(c/1e3),m(d,e,p(c)?!1:b)}function p(a){var b=!1;return _.each(D,function(c){var d=q(c.idX,c.idY);_.each(d,function(c){c.number===a&&(b=!0)})}),b}function q(a,b){return ba[a+","+b]}function r(a){var b,c,d,e,f,g,h=[];if(a.length){for(b=0,c=a.length;c>b;b++)for(g=a[b].blocId,f=a[b].range,d=0,e=f.length;e>d;d++)h.push(f[d].number);h.length&&(ha(),ea.getFacesByRange(h,t))}}function s(){var a,b=Math.round(window.innerWidth/G/2),c=Math.round(window.innerHeight/H/2),d=Y/G,e=Z/H,f=Math.round(Math.abs(y.position.x%Y/G)),g=Math.round(Math.abs(y.position.y%Z/H));return f=y.position.x>0?d-f:f,g=y.position.y>0?e-g:g,f+=b,g+=c,f=f>=d?f-d:f,g=g>=e?g-e:g,a=g*e+f}function t(a){v(a),u()}function u(){_.each(D,function(a){a.setValue(q(a.idX,a.idY))})}function v(a){for(var b=0;b<a.length;b++)a[b].picture&&(main.martixRange[a[b].number]=a[b])}var w,x,y,z,A,B,C,D=[],E=new PIXI.DisplayObjectContainer,F=window.screen.width>1600?.5:"desktop"==Tools.getDevice()?1:2,G="desktop"===Tools.getDevice()?180:190,H="desktop"===Tools.getDevice()?180:190,I=1,J=13,K=0,L=1e6-1,M=2,N=window.screen.width>1600?8:window.screen.width>1024?5:4,O=0,P=0,Q=0,R=0,S=0,T=1e3,U=100*F,V=10/F,W=1,X=10/F,Y=U*V*G,Z=T*H,$=G,aa=H,ba=[],ca=0,da=null,ea=new c,fa=!1,ga=_.throttle(function(){z.updateCursorPosition(s())},1e3),ha=_.throttle(function(){u()},1e3);d.on("ScrollContainer:StartMoving",function(){fa=!0}),d.on("ScrollContainer:StopMoving",function(){fa=!1}),PIXI.DisplayObjectContainer.call(this),w=this,g(),this.process=function(){y&&(y.scroll(),z.process(),C.process(),k())},this.resize=function(a,b){C.resize(),d.emit("blocItem:setUnselected"),i(),A=a,B=b}};return g.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),g.prototype.process=function(){this.process()},g.prototype.resize=function(a,b){this.resize(a,b)},g}),define("minimap",["constantes","messageBus","btnSocial","mapCursor","colorMapping"],function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n=function(e,l,m,n,o,p){PIXI.DisplayObjectContainer.call(this),f=e,g=l,h=o,i=p,j=m,k=n,this.mapDisplayed=!1,this.isDragging=!1,this.canDrag=!0,this.dragTimer=null,this.button=new PIXI.DisplayObjectContainer,this.map=new PIXI.DisplayObjectContainer,this.cursor=new d,this.button.x=0,this.button.y=g-40,this.map.x=0,this.map.y=n-40,this.map.pivot.y=n,this.icon=new c(a.icons.COORDINATES,"#FFFFFF",_.bind(this.toggleMap,this)),this.icon.x=5,this.icon.y=5,this.background=new PIXI.Graphics,this.updateBackgroundMap(),this.home=new c(a.icons.HOME,"#55acee",_.bind(this.goToMe,this)),this.home.interactive=this.home.buttonMode=!0,this.home.visible=!!_app.currentUser,this.map.interactive=!0,this.cursor.cursorIcon.interactive=this.cursor.cursorIcon.buttonMode=!0,this.cursor.cursorIcon.mousedown=this.cursor.cursorIcon.touchstart=_.bind(this.onDown,this),window.addEventListener("mouseup",_.bind(this.onUp,this)),window.addEventListener("touchend",_.bind(this.onUp,this)),window.addEventListener("mouseleave",_.bind(this.onUp,this)),this.hideMap(),this.cursor.position.x=0,this.cursor.position.y=0,this.home.position=this.getHomePosition(),this.home.pivot.x=this.home.width/2,this.home.pivot.y=this.home.height/2,this.addChild(this.button),this.addChild(this.map),this.addChild(this.cursor),b.on("all:colorChange",_.bind(this.updateBackgroundMap,this)),b.on("all:colorChange",_.bind(this.updateIconsColor,this)),this.button.addChild(this.icon),this.map.addChild(this.background),this.map.addChild(this.home)};return n.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),n.constructor=n.prototype.constructor,n.prototype.updateIconsColor=function(a){var b=a&&a.data?a.data.color:16777215;this.icon._text.tint=b},n.prototype.updateNumberColor=function(){},n.prototype.updateBackgroundMap=function(a){var b=a&&a.data?a.data.color:0;this.background.clear(),this.background.beginFill(0,.5),this.background.lineStyle(1,b),this.background.drawRect(0,0,f,g),this.background.endFill()},n.prototype.updateCursorPosition=function(a){this.canDrag&&(m!==a&&(this.cursor.setNumber(a),this.setCursorPositionByNumber(a)),b.emit("all:colorChange",{color:e.getColorByBoxNumber(a)}),m=a)},n.prototype.onDown=function(a){l=a,this.isDragging=!0,this.cursor.dragging()},n.prototype.onUp=function(a){this.isDragging&&(this.isDragging=!1,this.canDrag=!1,this.cursor.unDragging(),clearTimeout(this.dragTimer),this.dragTimer=setTimeout(_.bind(function(){this.canDrag=!0},this),5e3),b.emit("map:gotoFaceNumber",{number:this.cursor.numberFace,directly:!1}))},n.prototype.onMove=function(a){if(this.isDragging){var b=a.getLocalPosition(this.background);this.cursor.position.x=Math.min(f,Math.max(0,b.x)),this.cursor.position.y=Math.min(g,Math.max(0,b.y)),b=this.cursor.position;var c=b.x/f,d=b.y/g,e=Math.round(h/j*c)-1,l=Math.round(i/k*d),m=l>0?l*(i/k)+e-i/k:e;this.cursor.setNumber(Math.max(0,m))}},n.prototype.setCursorPositionByNumber=function(a){var b=this.calcPositionByNumber(a);this.cursor.position.x=b.x,this.cursor.position.y=b.y},n.prototype.calcPositionByNumber=function(a){var b={x:0,y:0},c=h/j,d=h/j,e=Math.round(a/c),i=Math.round(a%d);return b.x=i/c*f,b.y=e/d*g,b},n.prototype.getHomePosition=function(){return _app.currentUser?this.calcPositionByNumber(_app.currentUser.number):{x:0,y:0}},n.prototype.goToMe=function(){b.emit("map:gotoFaceNumber",{number:_app.currentUser.number,directly:!1})},n.prototype.displayMap=function(){this.mapDisplayed=!0,TweenLite.to(this.map.scale,.25,{x:1,y:1}),TweenLite.to(this.map,.25,{alpha:1}),TweenLite.to(this.cursor,.25,{alpha:1,delay:.15}),this.icon._text.setText(a.icons.CIRCLE_CLOSE)},n.prototype.hideMap=function(){this.mapDisplayed=!1,TweenLite.to(this.map.scale,.25,{x:0,y:0,delay:.15}),TweenLite.to(this.map,.25,{alpha:0,delay:.15}),TweenLite.to(this.cursor,.25,{alpha:0}),this.icon._text.setText(a.icons.COORDINATES)},n.prototype.toggleMap=function(){this[this.mapDisplayed?"hideMap":"displayMap"]()},n.prototype.process=function(){this.onMove(l)},n.prototype.resize=function(){},n});
//# sourceMappingURL=scripts.js.map